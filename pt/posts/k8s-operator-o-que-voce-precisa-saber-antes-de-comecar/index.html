<!doctype html><html lang=en><head><title>Entendendo os Operators no k8s - Outro blog nerd</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Engenharia e Arquitetura de Software para o mundo real, com bastante conceito e não só o framework da modinha"><meta name=author content="Thiago Henrique"><meta property="og:title" content="Entendendo os Operators no k8s"><meta property="og:description" content="Neste artigo serão apresentados conceitos necessários para que você consiga desenvolver um Kubernetes Operator, compreendendo o que de fato ele é e como funciona."><meta property="og:type" content="article"><meta property="og:url" content="https://www.thiagohenrique.com.br/pt/posts/k8s-operator-o-que-voce-precisa-saber-antes-de-comecar/"><meta property="article:published_time" content="2021-02-28T00:09:33-03:00"><meta property="article:modified_time" content="2021-02-28T00:09:33-03:00"><meta property="og:site_name" content="Outro blog nerd"><meta name=twitter:card content="summary"><meta name=twitter:title content="Entendendo os Operators no k8s"><meta name=twitter:description content="Neste artigo serão apresentados conceitos necessários para que você consiga desenvolver um Kubernetes Operator, compreendendo o que de fato ele é e como funciona."><meta name=generator content="Hugo 0.80.0"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://www.thiagohenrique.com.br/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=/css/styles.css></head><body><div id=container><header><h1><a href=/pt/>Outro blog nerd</a></h1><ul id=social-media><li><a href=/en>English</a></li><li><a href=https://github.com/thiagohdeplima title=GitHub><i class="fab fa-github fa-lg"></i></a></li><li><a href=https://twitter.com/thiagohdeplima title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://linkedin.com/in/thiagohdeplima title=LinkedIn><i class="fab fa-linkedin fa-lg"></i></a></li><li><a href=https://stackoverflow.com/users/5036456/thiago-henrique title=StackOverflow><i class="fab fa-stack-overflow fa-lg"></i></a></li><li><a href=https://www.instagram.com/thiagohdeplima title=Instagram><i class="fab fa-instagram fa-lg"></i></a></li><li><a href=https://www.youtube.com//channel/UCDnuQ9P6JRdkG9HNw5yDp9Q title=Youtube><i class="fab fa-youtube fa-lg"></i></a></li><li><a href=https://dev.to/thiagohdeplima title=devto><i class="fab fa-dev fa-lg"></i></a></li></ul><p><em>With no bike-shed effect</em></p></header><nav><ul><li><a href=/pt/open-source/><i class="fa-li fa fa-lg"></i><span>Open-Source</span></a></li><li><a href=/pt/about/><i class="fa-li fa fa-lg"></i><span>Sobre</span></a></li></ul></nav><main><article><h1>Entendendo os Operators no k8s</h1><aside><ul><li><time class=post-date datetime=2021-02-28T00:09:33-03:00>Feb 28, 2021</time></li><li><em><a href=/pt/tags/kubernetes>#kubernetes</a>
,
<a href=/pt/tags/operator-sdk>#operator-sdk</a>
,
<a href=/pt/tags/kubebuilder>#kubebuilder</a></em></li><li>3 minutes read</li></ul></aside><h1 id=atenção-este-artigo-ainda-está-incompleto-logo-mais-finalizo->ATENÇÃO: ESTE ARTIGO AINDA ESTÁ INCOMPLETO. LOGO MAIS FINALIZO! :)</h1><p>Neste artigo serão apresentados conceitos necessários para que você consiga desenvolver um Kubernetes Operator, compreendendo o que de fato ele é e como funciona.</p><p>O conteúdo aqui parte do principio que você já entenda ao menos os objetos básicos do Kubernetes <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, bem como saiba utilizar o <code>kubectl</code>, e claro, saiba o que é o Kubernetes.</p><h2 id=arquitetura-do-kubernetes>Arquitetura do Kubernetes</h2><p>O Kubernetes não possui uma arquitetura monolítica. Ao invés disto, ele é composto de uma série de componentes de software independentes que se conectam entre si para fazer todo seu maquinário funcionar. <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h2 id=afinal-o-que-são-_operators_->Afinal, o que são <em>Operators</em> ?</h2><p><em>Operators</em> são um meio através do qual você pode estender o Kubernetes para fazê-lo atender a alguma necessidade específica a qual o mesmo não faça nativamente. A principal motivação para se criar um <em>Operator</em> é realizar a automação um trabalho repetitivo e complexo dentro do próprio Kubernetes. <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><p>Para tornar o entendimento mais &ldquo;palpável&rdquo;, imagine que você possui um sistema de banco de dados executando dentro do Kubernetes, para o qual você precisa subir e descer constantemente réplicas que são utilizadas para exploração de dados, além de gerenciar os usuários que podem acessar estes bancos de dados.</p><p>A criação de um <em>Operator</em> poderia viabilizar a execução desta tarefa de uma forma simples e automatizada, permitindo que você gerencie dentro do próprio Kubernetes as suas instâncias de banco de dados, bem como os usuários contidos nele.</p><p>Imagine que, após criar um <em>Operator</em> que automatize todas estas tarefas, seria possível criar uma réplica e um novo usuário no Kubernetes somente por enviar os YAML como estes abaixo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>database.example.com/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DatabaseReplica</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-replica-database</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>master</span>: <span style=color:#ae81ff>name-of-my-master</span>

---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>database.example.com/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DatabaseUser</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>my-username</span>
  <span style=color:#f92672>password</span>: 
    <span style=color:#f92672>secretRef</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>secret-with-password</span>
</code></pre></div><p>O processo de operação das réplicas e usuários se tornaria mais fácil, pois ao invés de reproduzir uma série de passos complexos e especializados, bastaria realizar o envio destes YAML ao Kubernetes, que se encarregaria de executar os passos por meio do <em>Operator</em>.</p><p>Além disto, por meio do Operator teríamos a possíbilidade de gerir estas réplicas e usuários por meio do <code>kubectl</code>, uma vez que o <em>Operator</em> criaria recursos na API do Kubernetes para tal.</p><p>Ou seja, você poderia listar todos seus usuários por meio de um <code>kubectl get database-users</code>, ou réplicas através de um <code>kubectl get database-replicas</code>.</p><h2 id=como-o-kubernetes-funciona>Como o Kubernetes funciona?</h2><p>Para entender como um <em>Operator</em> funciona no Kubernetes, entender a arquitetura do próprio Kubernetes é fundamental.</p><hr><p>O Kubernetes é notóriamente um sistema distribuído completo e complexo, com uma série de componentes que interagem entre si para fazer o maquinário inteiro funcionar. Em sistemas como este é esperado que hajam sincronizações constantes e geralmente assíncronas em suas entidades internas, no caso, os objetos do Kubernetes. <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><p>No Kubernetes, a orquestração destas sincronizações é realizada por um componente chamado Control Plane, este por sua vez sendo composto por uma série de outros componentes menores.</p><hr><p>O Control Plane é um dos componentes centrais do Kubernetes, que por sua vez é composto por uma série de componentes menores, dentre os quais está incluso o <em>kube-apiserver</em>, que é basicamente a aplicação que expõe a API do Kubernetes para todo e qualquer <em>client</em> que vá interagir com o Cluster, entre eles o próprio kubectl.</p><p>Ao receber um pedido de alteração no cluster (por exemplo, criação de um novo Pod), a API não é responsável por aplicá-la, e sim simplesmente validá-la e posteriormente armazenar a alteração desejada para que outro componente possa posteriormente aplicá-la: O Controller.</p><h2 id=mãos-na-massa>Mãos na massa</h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/>Understanding Kubernetes Objects</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://kubernetes.io/docs/concepts/overview/components/>Kubernetes Components</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://kubernetes.io/docs/concepts/extend-kubernetes/operator/>Extending Kubernetes: Operator pattern</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/>Understanding Kubernetes Objects</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p><a href=https://www.redhat.com/pt-br/resources/oreilly-kubernetes-operators-automation-ebook>Dobies, J., &amp;; Wood, J. (2020). Kubernetes operators: Automating the container orchestration platform. Beijing ; O&rsquo;Reilly.</a> <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><section class=post-nav><ul></ul></section></main><footer><h6>Creative Commons by 4.0 |
Rendered by <a href=https://gohugo.io title=Hugo>Hugo</a> |
<a href=https://www.thiagohenrique.com.br/index.xml>Subscribe</a></h6></footer></div><script src=/js/scripts.js></script></body></html>